# Phone Manager Backend - Default Configuration
# Override values using environment variables with PM__ prefix
# Example: PM__SERVER__PORT=9000

[server]
# Host address to bind to
host = "0.0.0.0"

# Port to listen on
port = 8080

# Request timeout in seconds
request_timeout_secs = 30

# Maximum request body size in bytes (1MB default)
max_body_size = 1048576

# Base URL for the mobile app (used in invite URLs, deep links, QR codes)
# MUST be configured in production via PM__SERVER__APP_BASE_URL
app_base_url = "https://app.example.com"

[database]
# Database connection URL (REQUIRED - must be set via environment)
# Format: postgres://user:password@host:port/database
# Set via PM__DATABASE__URL environment variable
url = ""

# Maximum number of connections in the pool
max_connections = 20

# Minimum number of connections to maintain
min_connections = 5

# Connection timeout in seconds
connect_timeout_secs = 10

# Idle connection timeout in seconds
idle_timeout_secs = 600

[logging]
# Log level: trace, debug, info, warn, error
level = "info"

# Log format: json (production) or pretty (development)
format = "json"

[security]
# CORS allowed origins (empty = allow all, use specific origins in production)
cors_origins = []

# Rate limit per minute per API key
rate_limit_per_minute = 100

[limits]
# Maximum devices per group
max_devices_per_group = 20

# Maximum locations per batch upload
max_batch_size = 50

# Location data retention in days
location_retention_days = 30

# Maximum length of device display name
max_display_name_length = 50

# Maximum length of group ID
max_group_id_length = 50

[map_matching]
# Map-matching service provider: osrm or valhalla
provider = "osrm"

# Map-matching service URL (OSRM or Valhalla endpoint)
# Set via PM__MAP_MATCHING__URL environment variable
url = ""

# Request timeout in milliseconds (30s default)
timeout_ms = 30000

# Rate limit: maximum requests per minute to external service
rate_limit_per_minute = 30

# Circuit breaker: failures before opening
circuit_breaker_failures = 5

# Circuit breaker: seconds to stay open before half-open retry
circuit_breaker_reset_secs = 60

# Whether map-matching is enabled (can be disabled if service unavailable)
enabled = false

[jwt]
# RSA private key in PEM format for signing tokens (REQUIRED for auth)
# Set via PM__JWT__PRIVATE_KEY environment variable
# Generate with: openssl genrsa -out private.pem 2048
private_key = ""

# RSA public key in PEM format for verifying tokens (REQUIRED for auth)
# Set via PM__JWT__PUBLIC_KEY environment variable
# Generate with: openssl rsa -in private.pem -pubout -out public.pem
public_key = ""

# Access token expiration in seconds (default: 1 hour)
access_token_expiry_secs = 3600

# Refresh token expiration in seconds (default: 30 days)
refresh_token_expiry_secs = 2592000

# Leeway in seconds for clock skew tolerance (default: 30 seconds)
# Allows tokens to be accepted if they expired within this many seconds
# This compensates for minor clock differences between client and server
leeway_secs = 30

[email]
# Whether email sending is enabled (set to true in production)
enabled = false

# Email provider: console (development), smtp, sendgrid, or ses
# console: Logs emails to console (default for development)
# smtp: Uses SMTP server
# sendgrid: Uses SendGrid API
# ses: Uses AWS SES (future)
provider = "console"

# SMTP configuration (for smtp provider)
# smtp_host = "smtp.example.com"
# smtp_port = 587
# smtp_username = ""
# smtp_password = ""
# smtp_use_tls = true

# SendGrid API key (for sendgrid provider)
# Set via PM__EMAIL__SENDGRID_API_KEY environment variable
# sendgrid_api_key = ""

# AWS SES region (for ses provider)
# ses_region = "us-east-1"

# Sender email address (From header)
# MUST be configured in production via PM__EMAIL__SENDER_EMAIL
sender_email = "noreply@example.com"

# Sender name (From header)
sender_name = "Phone Manager"

# Base URL for email links (e.g., verification, password reset)
# Set via PM__EMAIL__BASE_URL environment variable
base_url = ""

# Email template style: html or plain
template_style = "html"
